import{X as e,r as t,af as n,Z as r,$ as i,U as o,ag as a,ah as l,a6 as c}from"./index-vXRN0nb0.js";import{D as s}from"./dot-loading-BBOaOjEl.js";const u="adm-infinite-scroll",d={threshold:250,children:(e,t,n)=>o.createElement(m,{hasMore:e,failed:t,retry:n})},f=c=>{const s=e(d,c),[f,m]=t.useState(!1),h=n((e=>a(void 0,void 0,void 0,(function*(){try{yield s.loadMore(e)}catch(t){throw m(!0),t}})))),E=t.useRef(null),[v,g]=t.useState({}),y=t.useRef(v),[p,w]=t.useState(),{run:M}=r((()=>a(void 0,void 0,void 0,(function*(){if(y.current!==v)return;if(!s.hasMore)return;const e=E.current;if(!e)return;if(!e.offsetParent)return;const t=l(e);if(w(t),!t)return;const n=e.getBoundingClientRect().top,r=function(e){return e===window}(t)?window.innerHeight:t.getBoundingClientRect().bottom;if(r>=n-s.threshold){const e={};y.current=e;try{yield h(!1),g(e)}catch(i){}}}))),{wait:100,leading:!0,trailing:!0});return t.useEffect((()=>{M()})),t.useEffect((()=>{if(E.current&&p)return p.addEventListener("scroll",e),()=>{p.removeEventListener("scroll",e)};function e(){M()}}),[p]),i(s,o.createElement("div",{className:u,ref:E},"function"==typeof s.children?s.children(s.hasMore,f,(function(){return a(this,void 0,void 0,(function*(){m(!1);try{yield h(!0),g(y.current)}catch(e){}}))})):s.children))},m=e=>{const{locale:t}=c();return e.hasMore?e.failed?o.createElement("span",null,o.createElement("span",{className:`${u}-failed-text`},t.InfiniteScroll.failedToLoad),o.createElement("a",{onClick:()=>{e.retry()}},t.InfiniteScroll.retry)):o.createElement(o.Fragment,null,o.createElement("span",null,t.common.loading),o.createElement(s,null)):o.createElement("span",null,t.InfiniteScroll.noMore)};export{f as I};
